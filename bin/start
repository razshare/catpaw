#!/usr/bin/env php
<?php

use CatPaw\Attributes\Option;
use CatPaw\Bootstrap;
$_ENV = [
    ...$_ENV,
    ...getenv(),
];
require 'vendor/autoload.php';


$entry       = new Option('--entry');
$name        = new Option('--name');
$libraries   = new Option('--libraries');
$resources   = new Option('--resources');
$dieOnChange = new Option('--die-on-change');
$watch       = new Option('--watch');
$info        = new Option('--info');

$entry       = $entry->findValue()             ?? '';
$name        = $name->findValue()              ?? 'App';
$libraries   = $libraries->findValue()         ?? '';
$resources   = $resources->findValue()         ?? '';
$dieOnChange = $dieOnChange->findValue('bool') ?? false;
$watch       = $watch->findValue('bool')       ?? false;
$info        = $info->findValue('bool')        ?? false;

try {
    if ($watch) {
        Bootstrap::spawn(
            start: __FILE__,
            entry: $entry,
            name: $name,
            libraries: $libraries,
            info: $info,
            watch: true,
            resources: $resources,
        );
    } else {
        Bootstrap::start(
            entry: $entry,
            name: $name,
            libraries: $libraries,
            info: $info,
            dieOnChange: $dieOnChange,
            resources: $resources,
        );
    }
} catch (Throwable $e) {
    die(((string)$e).PHP_EOL);
}
