#!/usr/bin/php
<?php
use CatPaw\Bootstrap;
require 'vendor/autoload.php';

[
    "w"          => $watchShort,
    "watch"      => $watchLong,
    "f"          => $fileShort,
    "file"       => $fileLong,
    "n"          => $nameShort,
    "name"       => $nameLong,
    "s"          => $singletonsShort,
    "singletons" => $singletonsLong,
    "v"          => $verboseShort,
    "verbose"    => $verboseLong,
] = [
    "w"          => null,
    "watch"       => null,
    "f"          => null,
    "file"       => null,
    "n"          => null,
    "name"       => null,
    "s"          => null,
    "singletons" => null,
    "v"          => null,
    "verbose"    => null,
    ...getopt("n::s::v::w::f:", [
        "file:",
        "name::",
        "verbose::",
        "singletons::",
        "watch::",
    ])
];

$file       = realpath($fileLong       ?? $fileShort);
$name       = $nameShort               ?? $nameLong               ?? "App";
$singletons = $singletonsLong ?? $singletonsShort;
$verbose    = $verboseLong             ?? $verboseShort;
$watch      = $watchLong               ?? $watchShort;

if($singletons)
    $singletons = realpath($singletons);

if (!$verbose && null !== $verbose) {
    $verbose = true;
} else {
    $verbose = false;
}

if (!$watch && null !== $watch) {
    $watch = true;
} else {
    $watch = false;
}

try{
    Bootstrap::start(
        file: $file,
        name: $name,
        singletons: $singletons,
        verbose: $verbose,
        watch: $watch,
    );
}catch(Throwable $e){
    die(join(PHP_EOL,[
        $e->getMessage(),
        $e->getTraceAsString(),
    ])).PHP_EOL;
}
