# Error Management

Do not throw exceptions in your code, instead return your errors as _Unsafe\<T\>_.

```php
namespace CatPaw\Core;
/**
 * @template T
 */
readonly class Unsafe {
    /** @var T $value */
    public $value;
    public false|Error $error;
}
```

Use the _ok()_ and _error()_ functions to create _Unsafe\<T\>_ objects.

## ok()

```php
namespace CatPaw\Core;
/**
 * @template T
 * @param T $value
 * @return Unsafe<T>
 */
function ok($value);
```

## error()

```php
namespace CatPaw\Core;
/**
 * @param string|Error $error
 * @return Unsafe<void>
 */
function error($error);
```

## Example

Reading a file.

```php
use CatPaw\Core\File;
use function CatPaw\Core\error;

function main(){
  // 1. Open file
  $fileAttempt = File::open('file.txt');
  if($fileAttempt->error){
      return error($fileAttempt->error);
  }
  $file = $fileAttempt->value;

  // 2. Read contents
  $readAttempt = $file->readAll()->await();
  if($readAttempt->error){
      return error($readAttempt->error);
  }
  $content = $readAttempt->value;

  // 3. Close file
  $file->close();

  // 4. Print stdout
  print($content);
}
```

Delete a file.

```php
use CatPaw\Core\File;
use function CatPaw\Core\error;

function main(){
  if($error = File::delete('./test.txt')->error){
      return error($error);
  }
}
```

## try()

The _Unsafe_ class provides a utility method called _try()_

```php
/**
 * @param Error $error
 * @return T
 */
public function try(&$error);
```

It will unwrap the value and assign any error to the _$error_ parameter by reference.\
Whenever the _Unsafe_ object holds an error you can use the `or <expression>` syntax to manage it.

```php
<?php
use CatPaw\Core\File;
use function CatPaw\Core\stop;

function main() {
  $file = File::open('file.txt')->try($error)
  or stop("End the program.");

  echo $file->readAll()->await()->try($error)
  or stop("End the program.");
}
```

The program will end if any errors are detected.

## anyError()

Instead of checking every error manually you can instead wrap your code in _anyError()_

```php
namespace CatPaw\Core;
/**
 * @template T
 * @param  callable():Generator<Unsafe|Error|T> $function
 * @return Unsafe<T>
 */
function anyError($function);
```

This function takes a generator and consumes it.

> [!NOTE]
> If the generator yields any _Error_ (or any _Unsafe_ that contains an _Error_) the function returns immediately a new _Unsafe\<T\>_ with the given error.\
> \
> If the generator yields no error, the function returns the generator value _T_.


Here's the read file example again, but written using _anyError()_.

```php
<?php
use CatPaw\Core\File;
use function CatPaw\Core\anyError;

function main(){
    return anyError(function() {
        // 1. Open file
        $file = File::open('file.txt')->try($error)
        or yield $error;

        // 2. Read contents
        $content = $file->readAll()->await()->try($error)
        or yield $error;

        // 3. Close file
        $file->close();

        // 4. Print to stdout
        print($content);
    });
}
```
