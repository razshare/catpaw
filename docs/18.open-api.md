> **Note**\
> _Attributes used in this document_
> - `#[Produces]` - _supported by the open api service_ ✅
> - `#[IgnoreOpenApi]` - _supported by the open api service_ ✅
> - `#[Summary]` - _supported by the open api service_ ✅
> - `#[Example]` - _supported by the open api service_ ✅
> - `#[Body]` - _not supported by the open api service_ ✖

# Open API

The web server comes with an open api scanner by default which can be found in the `\CatPaw\Web\Services\OpenApiService`
service.

The service will automatically document your route handlers as you're creating them.

In order to obtain the resulting open api json you can use the method `OpenApiService::getData`.

```php
use function CatPaw\Core\stop;
use CatPaw\Web\Attributes\IgnoreOpenApi;
use CatPaw\Web\Attributes\Produces;
use CatPaw\Web\Server;
use CatPaw\Web\Services\OpenApiService;
use CatPaw\Core\Unsafe;
use const CatPaw\Web\TEXT_PLAIN;
use const CatPaw\Web\OK;

function main():Unsafe {
    $server = Server::create()->try($error) or stop($error);
    $server->router->get(
        path: '/test',
        function:
        #[Produces(OK, TEXT_PLAIN, 'string')]
        static function() {
            return "this is a test";
        }
    );
    $server->router->get(
        path: "/openapi",
        function:
        #[IgnoreOpenApi] // this will omit the "/openapi" route itself from the documentation
        static fn (OpenApiService $openApiService) => $openApiService->getData()
    )->try($error)                         or stop($error);
    $server->start()->await()->try($error) or stop($error);
}
```

The above route will generate an openapi entry for the `\CatPaw\Web\Services\OpenApiService` service.

<details>
    <summary>OpenAPI Output JSON</summary>

```json
{
  "openapi": "3.0.0",
  "info": {
    "title": "OpenAPI",
    "version": "0.0.1"
  },
  "paths": {
    "/test": {
      "get": {
        "summary": "",
        "operationId": "fab75b617f6e066250e96d3501d4406aa5c25170",
        "parameters": [],
        "requestBody": {
          "description": "This is the body of the request",
          "required": true,
          "content": []
        },
        "responses": []
      }
    }
  }
}
```

</details>

# Documenting parameters and body

Parameters are documented automatically when injected, but you can also add some extra information like summaries and
examples.

```php
use function CatPaw\Core\stop;
use CatPaw\Core\Unsafe;
use CatPaw\Web\Attributes\Body;
use CatPaw\Web\Attributes\Example;
use CatPaw\Web\Attributes\Produces;
use CatPaw\Web\Attributes\Summary;
use CatPaw\Web\Server;
use const CatPaw\Web\TEXT_PLAIN;
use const CatPaw\Web\OK;

function main(): Unsafe {
    $server = Server::create()->try($error) or stop($error);
    $server->router->get(
        path: '/test/{value}',
        function:
        #[Produces(OK, TEXT_PLAIN, 'on success', 'string')]
        function(
            #[Summary('this is a summary of the parameter')]
            #[Example('this is an example value')]
            #[Body]
            string $body,
            string $value,
        ) {
            return "this is a test";
        }
    )->try($error)                         or stop($error);
    $server->start()->await()->try($error) or stop($error);
}
```

<details>
    <summary>OpenAPI Output JSON</summary>

```json
{
  "openapi": "3.0.0",
  "info": {
    "title": "OpenAPI",
    "version": "0.0.1"
  },
  "paths": {
    "/test/{value}": {
      "get": {
        "summary": "",
        "operationId": "92bc1bd07434281f59c47f4857aa504c0642bd2f",
        "parameters": [
          {
            "name": "value",
            "in": "path",
            "description": "this is a summary of the parameter",
            "required": true,
            "schema": {
              "type": "string"
            },
            "examples": {
              "example": {
                "value": "this is an example value"
              }
            }
          }
        ],
        "requestBody": {
          "description": "This is the body of the request",
          "required": true,
          "content": []
        },
        "responses": {
          "200": {
            "description": "",
            "content": {
              "text/plain": {
                "schema": {
                  "type": ""
                }
              }
            }
          }
        }
      }
    }
  }
}
```

</details>
