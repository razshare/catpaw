This feature requires the binary of `catpaw-dev-tools`, which can be downloaded [here](https://github.com/tncrazvan/catpaw-dev-tools/releases).
<hr/>

The reason this program exists is to help you manage your product life cycle by allowing you to publish new tags, export common files to all projects your product depends on and offers a complete tag nuke option for clearing all (local and remote) git tags.

The available options are 3: `--sync`, `--export`, `--delete-all-tags`.


__--sync__<br/>
   Synchronize origin repository and local repository.<br/>
   It will always try to create a new tag with the given version and update all the dependencies related to your projects.<br/>
   This will also run `composer fix`, so make sure this composer script exists.
   
__--export__<br/>
   Copy all `exports` (check the `product.yml` file) to all the other `projects`.<br/>
   Each project can overwrite `exports` by using the `imports` property.

__--delete-all-tags__<br/>
   Delete all repository local and remote tags, useful when tag naming becomes chaotic and needs a reset.

__--build__<br/>
   Build your catpaw project.

__--build-config__<br/>
   Genereate a default configuration file to use with `--build`.

---

More options will come in the future.

---

You __must__ specify a relative configuration `./product.yml` file.<br/>
An example of `./product.yml`:
```yaml
master: .

exports:
  - "bin"
  - ".vscode"
  - ".github"
  - ".php-cs-fixer.php"
  - "psalm.xml"
  - "build.yml"

projects:
  .:
    library: catpaw/dev-tools
    version: 0.4.35
  ../catpaw-core:
    library: catpaw/core
    version: 0.4.30
  ../catpaw-web:
    library: catpaw/web
    version: 0.4.30
  ../catpaw-cli:
    library: catpaw/cli
    version: 0.4.30
  ../catpaw-examples:
    library: catpaw/examples
    version: 0.4.30
  ../catpaw-mysql:
    library: catpaw/mysql
    version: 0.4.30
  ../catpaw-mysql-dbms:
    library: catpaw/mysql-dbms
    version: 0.4.30
  ../catpaw-optional:
    library: catpaw/optional
    version: 0.4.30
  ../catpaw-queue:
    library: catpaw/queue
    version: 0.4.30
  ../catpaw-raspberrypi:
    library: catpaw/raspberrypi
    version: 0.4.30
  ../catpaw-starter:
    library: catpaw/starter
    version: 0.4.30
  ../catpaw-store:
    library: catpaw/store
    version: 0.4.30
  ../catpaw-cui:
    library: catpaw/cui
    version: 0.4.30
  ../catpaw-spa:
    library: catpaw/spa
    version: 0.4.30
  ../catpaw-web-starter:
    library: catpaw/web-starter
    version: 0.4.30
  ../catpaw-svelte-starter:
    library: catpaw/svelte-starter
    version: 0.4.30
    imports:
      - "bin"
      - ".github"
      - ".php-cs-fixer.php"
      - "psalm.xml"
      - "build.yml"
  ../catpaw-server-linking:
    library: catpaw/server-linking
    version: 0.4.30
```

This configuration defines a master located in a directory called `.` (current directory).<br/>


The master project exports the following files to the other projects:

```yaml
exports:
  - "bin"
  - ".vscode"
  - ".github"
  - ".php-cs-fixer.php"
  - "psalm.xml"
  - "build.yml"
```

> **Note**
>
> By default each project `imports` everything the master project `exports`.
> 
> Each project can also statically specify what it should import from the master project by using the `imports` property.
> 
> As you can see the `catpaw-svelte-starter` project specifies the `imports` property.<br/>
> In this case `catpaw-svelte-starter` omits the `.vscode` directory and includes a new file called `some-other-file.txt`.
> 
> `imports` is not a subset of `exports`, it's an actual overwrite, so you're free to import whatever file you like.




### --build
```bash
php product.phar --build "build.yml"
```
> **Note** you can omit the file name and the builder will automatically look for `"build.yml"` or `"build.yaml"`
> ```bash
> php product.phar --build
> ```

This will execute the build functionality using the `build.yml` configuration file.

A build configuration file should look like this:
```yaml
name: app
entry: ./src/main.php
libraries: ./src/lib
match: /^\.\/(src|vendor|resources|dist|bin)\/.*/
```

Each property has a meaning.

- `name` is the name of the final .phar bundle.<br/>
  > **Note** if this name doesn't end with `".phar"`, the builder will automatically append `".phar"` and the end of the name.
- `entry` is the name of the catpaw entry file.<br/>
  > **Note** usually the file that contains your `main` function.
- `libraries` this is the catpaw library directory.<br/>
  > **Note** that you still need to match the directory using `match` below.<br/>
  > This simply instructs catpaw which libraries to bootstrap with.
- `match` matcher regex.<br/>
  This regex will be executed 
  against all files in the current directory and subdirectories.<br/>
  Anything matching this regex will be included in the
  final .phar file.




### --build-config
```bash
php product.phar --build-config
```
The binary can create a default `build.yml` for you using some defaults which should work fine for most applications.


## Usage examples

A few examples on how to use this binary.

### Delete all local and remote tags
```bash
php product.phar --delete-all-tags
```
This will delete all tags and releases.


### Export master files to the other projects
```bash
php product.phar --export
```
Will copy all fiels according the `exports` and `imports` definitions.

### Sync all repositories
```bash
php product.phar --sync
```
For each project this will...
1. run `composer fix`
1. fetch, pull, commit, push, try to create a new tag, push and then push tags

Once all of the above operations have completed for all projects, it will also run `composer update` for each project.

It may be necessary to run this option multiple times in order to synchronize everything properly due to repository webhooks latency.
