# Goffi

Invoke _Go_ functions from _Php_.

> [!CAUTION]
> This feature is experimental.


# Usage

> [!NOTE]
> You will need [Go](https://go.dev/) installed on your machine.

Write your _Go_ program, for example in a `goffi.go` file.

```go
// goffi.go
package main
import "C"
func main() {}

//export DoubleIt
func DoubleIt(x int) int {
return x * 2
}
```

The `//export DoubleIt` annotation will make it so that the function `DoubleIt()` will be exposed.

Compile your program to a shared object
```sh
go build -o libgoffi.so -buildmode=c-shared goffi.go
```
This will create 2 files, your shared object `libgoffi.so` and its C header file `libgoffi.h`.

Resolve the C header file's preprocessor directives.
```sh
cpp -P ./libgoffi.h ./libgoffi.static.h
```
This will create a `libgoffi.static.h` file, this file _must_ be located in the same directory as the `libgoffi.so` file.

Now use `goffi()` to interop with your _Go_ program from _Php_.

```php
<?php
// main.php
use function CatPaw\Core\goffi;

 interface Goffi {
     function DoubleIt(int $value);
 }

function main(){

 $lib = goffi(Goffi::class, './libgoffi.so')->try($error);
 if($error){
     return error($error);
 }

 $doubled = $lib->DoubleIt(3);
 echo "doubled: $doubled\n";
}
```

Run the program.

```sh
composer prod:start
```

It should print

```sh
doubled: 6
```
