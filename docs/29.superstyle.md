# Superstyle

Superstyle allows you to use just CSS to define your whole GUI.

Since [CSS' new nesting features](https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_nesting/Using_CSS_nesting) have been introduced, it has become possible to completely describe the structure of a DOM tree by using only CSS.

Obviously browsers don't have this native capability, and this is where Superstyle comes into play.

It's important to note that Superstyle doesn't have (and will probably never have) the capability to parse CSS rules, so it cannot provide any specific details regarding the actual CSS rules within the CSS selectors.\
It is just a thin layer which simply converts CSS selectors into HTML tags with their relative attributes.\
The only exception to this rule (no pun intended), is the `content` rule, which is parsed as the `innerText` of the element it is attached on to.


## Usage

First of al create a route handler and serve your superstyle document using the `superstyle()` function.

```php
<?php
// src/api/get.php
use function CatPaw\Superstyle\superstyle;
use function CatPaw\Core\asFilename;

return function(){
    return
        superstyle(asFileName(__DIR__, 'view.hbs'))
        ->setProperty('label', 'Click me!')
        ->render(title:'My title');
};
```



Then create the `view.hbs` file.

```hbs
<!-- src/api/view.hbs -->
<style is="super">
    main {
        font-family: 'Courier New', Courier, monospace;
        position: fixed;
        left: 0;
        right: 0;
        top: 0;
        bottom: 0;
        display: grid;
        background: #000000;

        button {
            content: "{{label}}";
            border: 0;
            font-size: 1.3rem;
            justify-self: center;
            align-self: center;
            background: rgb(234, 40, 5);
            color: rgb(233, 166, 155);
            border-radius: 3rem;
            padding: 1rem;
            cursor: pointer;
            box-shadow: 0;
            transition: 200ms transform;

            &:hover {
                transform: scale(1.1);
            }

            &:active {
                box-shadow: 0;
                transform: scale(0.9);
            }
        }
    }
</style>
```

Note the `is="super"` attribute on the style tag, that is required.

The style sheet itself must always declare a `main` element which will contain your application.

Any selector inside your `main` selector will be treated as a document node declaration.\
This means that any selector within `main` is declaring specific instances of the given tag name.\
If a selector doesn't specify a tag name, the tag name will default to `div`.


The final output should looks something like this

![Peek 2024-05-07 19-55](https://github.com/tncrazvan/catpaw/assets/6891346/9e318b01-2a72-42a6-acd9-a8c2423a8199)


## JavaScript

You can execute javascript code on your page as long as you write it in a `script` tag.

```html
<style is="super">
    main {}
</style>
<script>
    console.log("hello world")
</script>
```

This document will log `hello world` to the console whenever it loads.

## Handlebars

As you might have noticed, these are [Handlebars](https://handlebarsjs.com/) files.
Superstyle is currently using Handlebars for rendering dynamic documents.

> [!NOTE]
> There are plans to support more template systems in the future, such as Twig.

## Compilation

Templates are compiled into php functions and cached immediately the first time they render.

These php cached functions are saved into a `.tmp/handlebars` directory by default.

You can overwrite this location on the _HandlebarsService_

```php
<?php
use CatPaw\Web\Services\HandlebarsService;

function main(HandlebarsService $handlebars){
    $handlebars->withTemporaryDirectory('your/custom/tmp')
}
```

## Extending Classes

Although you cannot declare CSS classes within `main`, you can declare them outside and then extend them inside `main`.

Here's an example

```hbs
<style is="super">
    .btn {
        border: 0;
        font-size: 1.3rem;
        justify-self: center;
        align-self: center;
        background: rgb(234, 40, 5);
        color: rgb(233, 166, 155);
        border-radius: 3rem;
        padding: 1rem;
        cursor: pointer;
        box-shadow: 0;
        transition: 200ms transform;

        &:hover {
            transform: scale(1.1);
        }

        &:active {
            box-shadow: 0;
            transform: scale(0.9);
        }
    }

    main {
        button.btn{
            content: "This element extends styles from .btn";
        }
    }
</style>
```

## Custom Template

By default, superstyle wil render your content using a template that looks like this
```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>$title</title>
</head>
<body>
    <style>{$document->style}</style>
    {$document->markup}
    <script>{$document->script}</script>
</body>
</html>
```

This template can be replaced with a custom one using `SuperstyleRenderContext::template()`

> [!NOTE]
> The `superstyle()` function returns a `SuperstyleRenderContext`.

```php
<?php

use function CatPaw\Core\asFileName;
use function CatPaw\Superstyle\superstyle;
use CatPaw\Superstyle\SuperstyleDocument;


function customTemplate(SuperstyleDocument $document) {
    return <<<HTML
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>My Website</title>
        </head>
        <body>
            <style>{$document->style}</style>
            {$document->markup}
            <script>{$document->script}</script>
        </body>
        </html>
        HTML;
}


return fn () => superstyle(asFileName(__DIR__, './view.hbs'))
        ->template(customTemplate(...))
        ->render();
```

## HTMX

Although you can write your own javascript code to customize behavior, superstyle is meant to be used with declarative libraries like [HTMX](https://htmx.org/).

The following is a complete example of form submission and state management using superstyle and htmx.

First thing first, start the server.

```php
<?php
// src/main.php
use function CatPaw\Core\asFileName;
use CatPaw\Web\Server;

function main() {
    return Server::get()
        ->withApiLocation(asFileName(__DIR__, './api'))
        ->start();
}
```

Create a template fit for htmx.
```php
<?php
// src/lib/Template.php
namespace App;

use CatPaw\Superstyle\SuperstyleDocument;

final class Template {
    public static function htmx(SuperstyleDocument $document) {
        return <<<HTML
            <!DOCTYPE html>
            <html lang="en">
            <head>
                <meta charset="UTF-8">
                <meta name="viewport" content="width=device-width, initial-scale=1.0">
                <title>Document</title>
                <script src="https://unpkg.com/htmx.org@1.9.12"></script>
            </head>
            <body>
                <style>{$document->style}</style>
                {$document->markup}
                <script>{$document->script}</script>
            </body>
            </html>
            HTML;
    }
}
```

Expose the `GET /` api route and serve the superstyle document.\
This route simply renders the form in its base state.
```php
<?php
// src/api/get.php

use function CatPaw\Core\asFileName;
use function CatPaw\Superstyle\superstyle;
use App\Template;


return fn () => // The user just landed on the main page, 
                // provide them with a form to submit.
        superstyle(asFileName(__DIR__, './view.hbs'))
            ->template(Template::htmx(...))
            ->render();
```


Expose the `POST /form` api route.\
This route takes a form body as input and serves the handlebars view again, 
but this time with a `done` property set to `true` along with whatever data the user submitted.

```php
<?php

use function CatPaw\Core\asFileName;
use function CatPaw\Superstyle\superstyle;
use CatPaw\Web\Attributes\Body;
use App\Template;

return 
fn (#[Body] array $body) => // The has submitted the form.
    superstyle(asFileName(__DIR__, '../view.hbs'))
        ->setProperties([...$body, 'done' => true]) // Setting properties here.
        ->template(Template::htmx(...))
        ->render();
```

Expose the `GET /form` api route.\
This route redirects the user to the main page if they refresh the page after submitting the form.

```php
<?php
use function CatPaw\Web\redirect;
return fn () => // The user is loading page `/form` using perhaps the refresh button, 
                // we need to redirect back to the main form.
        redirect('/');
```

Now create the handlebars view document.
```hbs
<style is="super">
    .spacer-x {
        display: inline-block;
        padding-left: 1rem;
    }

    .red-button {
        border: 0;
        font-size: 1.3rem;
        justify-self: center;
        align-self: center;
        background: rgb(234, 40, 5);
        color: rgb(233, 166, 155);
        border-radius: 3rem;
        padding: 1rem;
        cursor: pointer;
        box-shadow: 0;
        transition: 200ms transform;

        &:hover {
            transform: scale(1.1);
        }

        &:active {
            box-shadow: 0;
            transform: scale(0.9);
        }
    }

    main {
        font-family: 'Courier New', Courier, monospace;
        position: fixed;
        left: 0;
        right: 0;
        top: 0;
        bottom: 0;
        display: grid;
        background: #000000;

        {{#if done}}
            div {
                justify-self: center;
                align-self: center;

                {{#if email}}
                    span {
                        color: #f1f1f1;
                        font-size: 1.3rem;
                        content: "Thank you for your submission {{email}}!";
                    }
                {{/if}}

                {{#unless email}}
                    span {
                        color: #f1f1f1;
                        font-size: 1.3rem;
                        content: "Please provide an email address :(";
                    }
                    
                    /* Spacing thins out a bit */
                    .spacer-x {}

                    form[hx-boost="true"][action="/"] {
                        display: inline-block;
                        button.red-button {
                            content: "Back";
                        }
                    }
                {{/unless}}
            }
        {{/if}}

        {{#unless done}}
            form[hx-boost="true"][action="/form"][method="post"] {
                justify-self: center;
                align-self: center;

                input[name="email"][type="email"][placeholder="Enter email..."] {
                    outline: 0;
                    border: 1px solid transparent;
                    font-size: 1.3rem;
                    padding: 1rem;
                    border-radius: 3rem;
                    background: #383232;
                    color: #f1f1f1;

                    &:focus {
                        border-color: rgb(234, 40, 5);
                    }
                }

                /* Spacing thins out a bit */
                .spacer-x {}
                
                button.red-button {
                    content: "Submit";
                }
            }
        {{/unless}}
    }
</style>
```
![Peek 2024-05-07 22-37](https://github.com/tncrazvan/catpaw/assets/6891346/58eca1cc-12e2-4522-b17f-ef8f61165a3f)
