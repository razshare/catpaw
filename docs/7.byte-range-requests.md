This feature requires the package `catpaw/web`, which can be installed using<br/>

```
composer require catpaw/web
```

<hr/>

# Byte Range Requests

Byte range requests are supported out of the box in the default `@404` handlers.<br/>
That being said, the feature is packed into one service called `CatPaw\Services\ByteRangeService`, which you can use to
serve your own requests manually.<br/>

## ByteRangeService

Here's a simple example of how you would use the service:

```php
use CatPaw\Web\Server;
use CatPaw\Web\Services\ByteRangeService;
use CatPaw\Web\Interfaces\ByteRangeWriterInterface;
use Amp\Http\Response;
use Amp\Http\Request;
use Amp\Http\HttpStatus;
use function Amp\File\getSize;

function main(){
    $server = Server::create();
    $server->router->get(
        path: "/{filename}",
        callback: function(
            string $filename,
            Request $request,
            Response $response,
            ByteRangeService $service,
        ){
            try {
                $byteRangeResponse = $byteRange->file(
                    range: $request->getHeader("range") ?? '',
                    fileName: $fileName,
                );
                $response->setStatus($byteRangeResponse->getStatus());
                $response->setHeaders([
                    ...(array)$byteRangeResponse->getHeaders(),
                    ...$attachmentHeaders,
                ]);
                $response->setBody($byteRangeResponse->getBody());
            } catch(InvalidByteRangeQueryException) {
                $fileSize = getSize($fileName);
                $response->setStatus(HttpStatus::OK);
                $response->setHeaders([
                    "Accept-Ranges"  => "bytes",
                    "Content-Type"   => Mime::findContentType($fileName),
                    "Content-Length" => $fileSize,
                    ...$attachmentHeaders,
                ]);
                $response->setBody(openFile($fileName, 'r'));
            }
        } 
    );
    $srver->start();
}
```

Your endpoint will now serve bye range requests.

> [!Note]
> The `ByteRangeService::file` method throws a `InvalidByteRangeQueryException` exception whenever the given range query is not valid.
