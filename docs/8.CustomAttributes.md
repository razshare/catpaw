# Custom Attributes

You can create your own attributes in order to apply changes to function parameters.<br/>

---

## Creating an attribute

A few things before starting:<br/>

- An attribute is a class that's annotated with `#[\Attribute]`.<br/>
- Attributes alone won't interact with CatPaw by themselves, in order to achieve enable that interaction the class must
  implement `CatPaw\Attributes\Interfaces\AttributeInterface`.
- The default `AttributeInterface` implementation is defined in the
  trait `CatPaw\Attributes\Traits\CoreAttributeDefinition`.

### Hello world

Create the attribute class<br/>

```php
use Attribute;
use CatPaw\Attributes\Interfaces\AttributeInterface;
use CatPaw\Attributes\Traits\CoreAttributeDefinition;

#[Attribute]
class HelloWorldAttribute implements AttributeInterface{
    use CoreAttributeDefinition;

    public function __construct() {
        echo "hello world\n";
    }
}
```

then annotate a function's parameter with it<br/>

```php
use \CatPaw\Tools\Helpers\Route;
Route::get(
  path:"/",
  callback: function(
      #[HelloWorldAttribute] string $hello = 'hello';
  ){
    return $hello;
  }
);
```

When executing the function, a new instance of the attribute will be created, which will output to the console the "
hello world" string and return "hello" as an output.

## Mutating a parameter

Simply creating an instance of the attribute might be enough in some cases, but in most cases more control is
required.<br/>

You can overwrite the `onParameter` method of the attribute in order to get more information on the parameter and change
it's value.<br/>

```php
use Attribute;
use CatPaw\Attributes\Interfaces\AttributeInterface;
use CatPaw\Attributes\Traits\CoreAttributeDefinition;
use CatPaw\Http\HttpContext;

#[Attribute]
class HelloWorldAttribute implements AttributeInterface{
    use CoreAttributeDefinition;

    public function __construct(private string $name) {}
    
    public function onParameter(ReflectionParameter $parameter, mixed &$value, false|HttpContext $http): Promise {
        return new LazyPromise(function() use (
            $parameter,
            &$value,
            $http
        ) {
            $value = "$value $this->name";
        });
    }
}
```

This will modify the default value of the parameter to `"$value $this->name"`, meaning that in the following case:

```php
use \CatPaw\Tools\Helpers\Route;
Route::get(
  path:"/",
  callback: function(
      #[HelloWorldAttribute('world'] string $hello = 'hello';
  ){
    return $hello;
  }
);
```

the output of the function will be `hello world`.