# Custom Attributes

1. An attribute is a class that's annotated with `#[Attribute]`.<br/>
2. Attributes alone won't interact with CatPaw by themselves, in order to enable that interaction the class must
   implement `CatPaw\Core\Interfaces\AttributeInterface`.
3. The default `AttributeInterface` implementation is defined in the
   trait `CatPaw\Core\Traits\CoreAttributeDefinition`.
4. Use any of the following extra interfaces to define special behaviour
    - `CatPaw\Core\Interfaces\OnParameterMount`\
      offers the `::onParameterMount` method, which will trigger
      before a parameter is about to be passed to a function or method.
      > **Note**\
      Usually used to resolve route handlers dependencies.\
      For example CatPaw itself uses this interface to inject `#[Param]` and `#[Query]` attributes.
    - `CatPaw\Core\Interfaces\OnFunctionMount`\
      offers the `::onFunctionMount` method, which will trigger before a function is mounted into scope.\
      > **Note**\
      Currently the only type of functions that are "mounted in scope" are route handlers.
    - `CatPaw\Core\Interfaces\OnClassInstantiation`\
      offers the `::onClassInstantiation` method.
      This interface has currently no use case.\
      In the future the `::onClassInstantiation` method will trigger whenever the dependency
      container (`CatPaw\Core\Container`) creates a new dependency (`CatPaw\Core\Container::create`).
    - `\CatPaw\Web\Interfaces\OnRequest`\
      offers the `::onRequest` method, which will trigger before a route handler is executed.
    - `\CatPaw\Web\Interfaces\OnResult`\
      offers the `::onResult` method, which will trigger after a route handler is executed but before the result of the
      route handler is served.\
      This is useful for modifying a response, much like a middleware would do, but much more restricted.

Create the class, annotate it with `#[Attribute]` and implement `AttributeInterface`

```php
use function CatPaw\Core\stop;
use CatPaw\Core\DependenciesOptions;
use CatPaw\Core\Interfaces\AttributeInterface;
use CatPaw\Core\Interfaces\OnParameterMount;
use function CatPaw\Core\ok;
use CatPaw\Core\Traits\CoreAttributeDefinition;
use CatPaw\Core\Unsafe;
use CatPaw\Web\Server;

#[Attribute]
class HelloWorldAttribute implements AttributeInterface, OnParameterMount {
    use CoreAttributeDefinition;
    public function onParameterMount(ReflectionParameter $reflection, mixed &$value, DependenciesOptions $options) : Unsafe {
        $value = "hello world";
        return ok();
    }
}

function main(): Unsafe {
    $server = Server::create()->try($error) or stop($error);
    $server->router->get(
        path: "/",
        callback: static fn (#[HelloWorldAttribute] string $greeting) => $greeting,
    )->try($error) or stop($error);
    $server->start()->await()->try($error) or stop($error);
}
```

The above code defines an attribute called `#[HelloWorldAttribute]`, which triggers on parameter mount and sets the
value of the parameter to `"hello world"`.

> **Note**\
> When the parameter mounts, a new instance of the attribute will be created.